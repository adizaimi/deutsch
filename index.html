<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Pair Display</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-align: center;
        }
        .word {
            position: absolute;
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 20px;
            width: 100px;
            user-select: none;
        }
        .on {
            background-color: #907080; /* Color for 'selected' box */
            transition: background-color 0s ease; /* Smooth transition */
        }
    </style>
</head>
<body onclick="showNextPair()">
  <script src="wl.js"></script>
  <script>

/* Define your pairs of symbols
const pairs = [
    { key: 'a/A', value: 'a, A' },
    { key: 'b', value: 'B' },
    { key: 'c', value: 'C' },
    { key: 'd', value: 'D' },
    { key: 'e', value: 'E' },
    { key: 'f', value: 'F' },
    { key: 'g', value: 'G' },
    { key: 'h', value: 'H' },
    { key: 'i', value: 'I' },
    { key: 'j', value: 'J' },
    { key: 'k', value: 'K' },
    { key: 'l', value: 'L' },
    { key: 'm', value: 'M' },
    { key: 'n', value: 'N' },
    { key: 'o', value: 'O' },
    { key: 'p', value: 'P' },
    { key: 'q', value: 'Q' },
    { key: 'r', value: 'R' },
    { key: 's', value: 'S' },
    { key: 't', value: 'T' },
    { key: 'u', value: 'U' },
    { key: 'v', value: 'V' },
    { key: 'w', value: 'W' },
    { key: 'x', value: 'X' }
]; */

    const keyEl = createWordElement("AAA", true);
    const valueEl = createWordElement("BBB", false);
    document.body.appendChild(keyEl);
    document.body.appendChild(valueEl);
    let shuffledPairs = [...pairs].sort(() => Math.random() - 0.5); // Shuffle the pairs once
    let currentIndex = 0;
    let touchStartX = 0;

    // Initial display
    window.onload = showCurrentPair;


    function getRandomPair() {
        const randomIndex = Math.floor(Math.random() * pairs.length);
        return pairs[randomIndex];
    }

	function pickRandomSplitEntry (str, splitChar) {
		const entries = str.split(splitChar);
		if (entries.length < 2)
			return str;
		//console.log(entries); // debug print the pairs
		const trimmedEntries = entries.map(item=>item.trim());
		//console.log(trimmedEntries); // debug print the pairs
		const randomIndex = Math.floor(Math.random() * trimmedEntries.length);
		//console.log(randomIndex); // debug print the pairs
		return trimmedEntries[randomIndex];
	}

    function createWordElement(text, isKey) {
        const div = document.createElement('div');
        div.className = 'word';
        div.style.width = `${(window.innerWidth - 30)}px`;
        div.textContent = text.trim();
        div.style.left = `20px`; // Avoid edges
        if (isKey) {
            div.style.top = `20px`;
            //div.addEventListener('click', () => playWordSound(div));
            div.addEventListener('click', (event) => { 
                event.stopPropagation();
                playWordSound(div);
                div.classList.add('on');
                setTimeout(() => { div.classList.remove('on'); }, 300);
            })
            div.addEventListener('touchend', (event) => { 
                event.stopPropagation();
                event.preventDefault();
                playWordSound(div);
                div.classList.add('on');
                setTimeout(() => { div.classList.remove('on'); }, 300);
            })
            div.addEventListener('touchend', (event) => { 
            })
        } else
            div.style.top = `150px`;
        return div;
    }

    function clearScreen() {
        document.body.querySelectorAll('.word').forEach(el => el.remove());
    }

    function showCurrentPair() {
        const pair = shuffledPairs[currentIndex];
        if (pair == undefined) {
            console.log("Pair is undefined");
            console.log(pair);
            throw("Pair is undefined");
        }
        keyEl.textContent = pickRandomSplitEntry(pair.key, '/');
        valueEl.textContent = pickRandomSplitEntry(pair.value, ',');
    }

    function showNextPair() {
        currentIndex = (currentIndex + 1) % shuffledPairs.length;
        showCurrentPair();
    }

    function showPreviousPair() {
        currentIndex = (currentIndex - 1 + shuffledPairs.length) % shuffledPairs.length;
        showCurrentPair();
    }

    // Touch events for swipe and tap
    document.body.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
    });

    document.body.addEventListener('touchend', e => {
        const touchEndX = e.changedTouches[0].screenX;
        const deltaX = touchEndX - touchStartX;

        if (Math.abs(deltaX) <= 20) {
            // Tap: next
            showNextPair();
        } else if (deltaX > 20) {
            // Swipe right: next
            showNextPair();
        } else if (deltaX < -20) {
            // Swipe left: previous
            showPreviousPair();
        }
    });

    // For desktop: click as next
    document.body.addEventListener('click', e => {
        if (!e.touches) { // Avoid double trigger on touch devices
            showNextPair();
        }
    });

function playWordSound(div) {
    const word = div.textContent.trim();

    // Check if SpeechSynthesis is supported
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = 'de-DE'; // Set to German
        utterance.volume = 1.0; // 0 to 1
        utterance.rate = 1.0; // 0.1 to 10
        utterance.pitch = 1.0; // 0 to 2

        // Optionally select a specific voice
        const voices = window.speechSynthesis.getVoices();
        const germanVoice = voices.find(voice => voice.lang === 'de-DE');
        if (germanVoice) {
            utterance.voice = germanVoice; // Use German voice (e.g., Siriâ€™s Anna)
        }

        // Play the speech
        window.speechSynthesis.speak(utterance);

        // Log for debugging
        console.log('Playing TTS for:', word);
    } else {
        console.error('SpeechSynthesis not supported');
        alert('Text-to-speech is not supported in this browser.');
    }
}

  </script>
  <audio id="wordAudio" src=""></audio>
</body>
</html>
